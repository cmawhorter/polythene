{"version":3,"file":"polythene-core-ripple.js","sources":["../src/animation.js","../../polythene-css-classes/ripple.js","../src/ripple.js"],"sourcesContent":["import { isTouch, getAnimationEndEvent, isServer } from \"polythene-core\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    getAnimationEndEvent();\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst addStyleToHead = (id, stylesheet) => {\n  if (isServer) return;\n  const documentRef = window.document;\n  const styleEl = documentRef.createElement(\"style\");\n  styleEl.setAttribute(\"id\", id);\n  styleEl.appendChild(documentRef.createTextNode(stylesheet));\n  documentRef.head.appendChild(styleEl);\n};\n\nconst removeStyleFromHead = id => {\n  if (isServer) return;\n  const el = document.getElementById(id);\n  if (el && el.parentNode) {\n    el.parentNode.removeChild(el);\n  }\n};\n\nexport default ({ e, id, el, attrs, classes }) => {\n  return new Promise(resolve => {\n    const container = document.createElement(\"div\");\n    container.setAttribute(\"class\", classes.mask);\n    el.appendChild(container);\n    const waves = document.createElement(\"div\");\n    waves.setAttribute(\"class\", classes.waves);\n    container.appendChild(waves);\n    const rect = el.getBoundingClientRect();\n    const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const mx = (attrs.center) ? (rect.left + rect.width / 2) : x;\n    const my = (attrs.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const startOpacity = attrs.startOpacity !== undefined\n      ? attrs.startOpacity\n      : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = attrs.opacityDecayVelocity !== undefined\n      ? attrs.opacityDecayVelocity\n      : OPACITY_DECAY_VELOCITY;\n    const endOpacity = attrs.endOpacity || DEFAULT_END_OPACITY;\n    const startScale = attrs.startScale || DEFAULT_START_SCALE;\n    const endScale = attrs.endScale || DEFAULT_END_SCALE;\n    const duration = attrs.duration\n      ? attrs.duration\n      : 1 / opacityDecayVelocity * 0.2;\n    const color = window.getComputedStyle(el).color;\n    \n    const style = waves.style;\n    style.width = style.height = waveRadius + \"px\";\n    style.top = ry + \"px\";\n    style.left = rx + \"px\";\n    style[\"animation-duration\"] =\n      style[\"-webkit-animation-duration\"] =\n      style[\"-moz-animation-duration\"] =\n      style[\"-o-animation-duration\"] = duration + \"s\";\n    style.backgroundColor = color;\n    style.opacity = startOpacity;\n    style.animationName = id;\n    style.animationTimingFunction = attrs.animationTimingFunction || vars.animation_curve_default;\n\n    const rippleStyleSheet = `@keyframes ${id} {\n      0% {\n        transform:scale(${startScale});\n        opacity: ${startOpacity}\n      }\n      100% {\n        transform:scale(${endScale});\n        opacity: ${endOpacity};\n      }\n    }`;\n    addStyleToHead(id, rippleStyleSheet);\n\n    const animationDone = evt => {\n      removeStyleFromHead(id);\n      waves.removeEventListener(ANIMATION_END_EVENT, animationDone, false);\n      if (attrs.persistent) {\n        style.opacity = endOpacity;\n        style.transform = \"scale(\" + endScale + \")\";\n      } else {\n        waves.classList.remove(classes.wavesAnimating);\n        container.removeChild(waves);\n        el.removeChild(container);\n      }\n      resolve(evt);\n    };\n\n    waves.addEventListener(ANIMATION_END_EVENT, animationDone, false);\n    waves.classList.add(classes.wavesAnimating);\n  });\n};\n","\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  unconstrained:  \"pe-ripple--unconstrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","import { pointerEndEvent, filterSupportedAttributes, isServer } from \"polythene-core\";\nimport animation from \"./animation\";\nimport classes from \"polythene-css-classes/ripple\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nexport const getInitialState = () => {\n  return {\n    animations: {},\n    animating: false,\n    cleanUp: undefined\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return {\n    ...filterSupportedAttributes(attrs),\n    className: [\n      classes.component,\n      attrs.unconstrained ? classes.unconstrained : null,\n      attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n      attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n      attrs.className || attrs[k.class],\n    ].join(\" \")\n  };\n};\n\nconst updateAnimationState = state =>\n  state.animating = Object.keys(state.animations).length > 0;\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  if (isServer) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  const tap = e => {\n    if (attrs.disabled || (!attrs.multi && state.animating)) {\n      return;\n    }\n    if (attrs.start) {\n      attrs.start(e);\n    }\n    const id = `ripple_animation_${new Date().getTime()}`;\n    state.animations[id] = animation({ e, id, el: vnode.dom, attrs, classes })\n      .then(evt => {\n        if (attrs.end) {\n          attrs.end(evt);\n        }\n        delete state.animations[id];\n        updateAnimationState(state);\n      });\n    updateAnimationState(state);\n  };\n  const triggerEl = attrs.target\n    ? attrs.target\n    : vnode.dom && vnode.dom.parentElement;\n\n  if (triggerEl) {\n    pointerEndEvent.forEach(evt =>\n      triggerEl.addEventListener(evt, tap, false));\n  }\n  state.cleanUp = () => {\n    if (triggerEl) {\n      pointerEndEvent.forEach(evt =>\n        triggerEl.removeEventListener(evt, tap, false));\n    }\n  };\n};\n\nexport const onUnMount = ({ state }) =>\n  state.cleanUp && state.cleanUp();\n"],"names":["ANIMATION_END_EVENT","getAnimationEndEvent","DEFAULT_START_OPACITY","DEFAULT_END_OPACITY","DEFAULT_START_SCALE","DEFAULT_END_SCALE","OPACITY_DECAY_VELOCITY","addStyleToHead","id","stylesheet","isServer","documentRef","window","document","styleEl","createElement","setAttribute","appendChild","createTextNode","head","removeStyleFromHead","el","getElementById","parentNode","removeChild","e","attrs","classes","Promise","resolve","container","mask","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","color","getComputedStyle","style","backgroundColor","opacity","animationName","animationTimingFunction","vars","animation_curve_default","rippleStyleSheet","animationDone","evt","removeEventListener","persistent","transform","classList","remove","wavesAnimating","addEventListener","add","component","unconstrained","getElement","vnode","element","getInitialState","animations","animating","cleanUp","createProps","k","keys","filterSupportedAttributes","className","tone","class","join","updateAnimationState","state","Object","length","onMount","dom","tap","disabled","multi","start","Date","getTime","animation","then","end","triggerEl","target","parentElement","pointerEndEvent","forEach","onUnMount"],"mappings":"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"}