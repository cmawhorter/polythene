{"version":3,"file":"polythene-core-notification.js","sources":["../../polythene-css-classes/notification.js","../src/notification.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-notification\",\n\n  // elements\n  action:         \"pe-notification__action\",\n  content:        \"pe-notification__content\",\n  holder:         \"pe-notification__holder\",\n  placeholder:    \"pe-notification__placeholder\",\n  title:          \"pe-notification__title\",\n\n  // states\n  hasContainer:   \"pe-notification--container\",\n  horizontal:     \"pe-notification--horizontal\",\n  multilineTitle: \"pe-notification__title--multi-line\",\n  vertical:       \"pe-notification--vertical\",\n  visible:        \"pe-notification--visible\",\n};","import { filterSupportedAttributes, transitionComponent, isClient, isServer } from \"polythene-core\";\nimport { Timer } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/notification\";\n\nconst DEFAULT_TIME_OUT = 3;\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst pause = state => {\n  state.paused(true);\n  if (state.timer) {\n    state.timer.pause();\n  }\n};\n\nconst unpause = state => {\n  state.paused(false);\n  if (state.timer) {\n    state.timer.resume();\n  }\n};\n\nconst stopTimer = state => {\n  if (state.timer) {\n    state.timer.stop();\n  }\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => stopTimer(state)\n    : () => stopTimer(state),\n  afterTransition: isShow\n    ? () => {\n      // set timer to hide in a few seconds\n      const timeout = attrs.timeout;\n      if (timeout === 0) {\n        // do not time out\n      } else {\n        const timeoutSeconds = timeout !== undefined\n          ? timeout\n          : DEFAULT_TIME_OUT;\n        state.timer.start(() => {\n          hideNotification(state, attrs);\n        }, timeoutSeconds);\n      }     \n    }\n    : null,\n  domElements: {\n    el: state.el,\n    containerEl: state.containerEl,\n  },\n  showClass: classes.visible,\n});\n\nconst showNotification = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideNotification = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst setTitleStyles = titleEl => {\n  if (isServer) return;\n  const height = titleEl.getBoundingClientRect().height;\n  const lineHeight = parseInt(window.getComputedStyle(titleEl).lineHeight, 10);\n  const paddingTop = parseInt(window.getComputedStyle(titleEl).paddingTop, 10);\n  const paddingBottom = parseInt(window.getComputedStyle(titleEl).paddingBottom, 10);\n  if (height > (lineHeight + paddingTop + paddingBottom)) {\n    titleEl.classList.add(classes.multilineTitle);\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  const paused = createStream(false);\n  const mounted = createStream(false);\n  const visible = createStream(false);\n  return {\n    cleanUp:        undefined,\n    containerEl:    undefined,\n    dismissEl:      undefined,\n    el:             undefined,\n    timer:          new Timer(),\n    paused,\n    transitioning,\n    visible,\n    mounted,\n    redrawOnUpdate: createStream.merge([visible])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const dom = vnode.dom;\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.el = dom;\n  const titleEl = state.el.querySelector(`.${classes.title}`);\n  if (titleEl) {\n    setTitleStyles(titleEl);\n  }\n  if (!state.containerEl && isClient) {\n    // attrs.holderSelector is passed as option to Multiple\n    state.containerEl = document.querySelector(attrs.containerSelector || attrs.holderSelector);\n  }\n  if (!state.containerEl && isClient) {\n    console.error(\"No container element found\"); // eslint-disable-line no-console\n  }\n  if (attrs.containerSelector && state.containerEl) {\n    state.containerEl.classList.add(classes.hasContainer);\n  }\n  if (attrs.show && !state.visible()) {\n    showNotification(state, attrs);\n  }\n  state.mounted(true);\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.mounted(false)\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    {\n      className: [\n        classes.component,\n        attrs.fromMultipleClassName,\n        // classes.visible is set in showNotification though transition\n        attrs.tone === \"light\" ? null : \"pe-dark-tone\", // default dark tone\n        attrs.containerSelector ? classes.hasContainer : null,\n        attrs.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      [k.onclick]: e => e.preventDefault()\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (state.mounted() && !state.transitioning()) {\n    if (attrs.hide && state.visible()) {\n      hideNotification(state, attrs);\n    } else if (attrs.show && !state.visible()) {\n      showNotification(state, attrs);\n    }\n  }\n  if (attrs.pause && !state.paused()) {\n    pause(state, attrs);\n  } else if (attrs.unpause && state.paused()) {\n    unpause(state, attrs);\n  }\n\n  return h(\"div\",\n    {\n      className: classes.content,\n      style: attrs.style,\n    },\n    attrs.content || [\n      attrs.title\n        ? h(\"div\",\n          { className: classes.title },\n          attrs.title\n        )\n        : null,\n      attrs.action\n        ? h(\"div\",\n          { className: classes.action },\n          attrs.action\n        )\n        : null\n    ]\n  );\n};\n"],"names":["component","action","content","holder","placeholder","title","hasContainer","horizontal","multilineTitle","vertical","visible","DEFAULT_TIME_OUT","getElement","vnode","attrs","element","pause","state","paused","timer","unpause","resume","stopTimer","stop","transitionOptions","isShow","beforeTransition","afterTransition","timeout","timeoutSeconds","undefined","start","hideNotification","domElements","el","containerEl","showClass","classes","showNotification","transitionComponent","setTitleStyles","titleEl","isServer","height","getBoundingClientRect","lineHeight","parseInt","window","getComputedStyle","paddingTop","paddingBottom","classList","add","getInitialState","createStream","transitioning","mounted","cleanUp","dismissEl","Timer","redrawOnUpdate","merge","onMount","dom","querySelector","isClient","document","containerSelector","holderSelector","console","error","show","onUnMount","createProps","k","keys","filterSupportedAttributes","remove","className","fromMultipleClassName","tone","layout","class","join","onclick","e","preventDefault","createContent","h","renderer","hide","style"],"mappings":"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"}