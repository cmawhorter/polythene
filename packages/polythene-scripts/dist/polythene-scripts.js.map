{"version":3,"file":"polythene-scripts.js","sources":["../src/write-css.js"],"sourcesContent":["const autoprefixer = require(\"autoprefixer\");\nconst cssbeautify  = require(\"cssbeautify\");\nconst fs           = require(\"fs\");\nconst J2c          = require(\"j2c\");\nconst postcss      = require(\"postcss\");\nconst cssnano      = require(\"cssnano\");\nconst tar          = require(\"tar\");\n\nconst j2c = new J2c();\nconst COLOR_RED = \"\\x1b[31m\";\nconst COLOR_WHITE = \"\\x1b[37m\";\n\nconst makeStyleSheet = (...styles) =>\n  styles.reduce((acc, styleList) =>\n    // each style returns a list\n    Object.keys(styleList).length\n      ? (\n        styleList.forEach(style => {\n          const scoped = {\n            \"@global\": style\n          };\n          const sheet = j2c.sheet(scoped);\n          acc += sheet;      \n        }),\n        acc\n      )\n      : acc, \"\");\n\nconst beautifyCSS = cssString =>\n  cssbeautify(cssString, {\n    indent: \"  \"\n  });\n\nconst saveToFile = (path, cssString) => \n  fs.writeFileSync(path, cssString, \"ascii\");\n\nexport const processCSS = ({ styles, path, autoPrefix }) => {\n  const cssString = styles.reduce((acc, current) => (\n    acc + makeStyleSheet(current)\n  ), \"\");\n  return { cssString, path, autoPrefix };\n};\n\nexport const writeCSS = ({ css, styles, path, autoPrefix, beautify, sourceMap=true, gzip }) => {\n  const cssString = css\n    ? css\n    : styles\n      ? styles.reduce((acc, current) => (\n        current !== undefined\n          ? acc + makeStyleSheet(current)\n          : (\n            console.log(\"No style passed to writeCSS. Make sure to use getStyle, not addStyle...\"), // eslint-disable-line no-console\n            acc\n          )\n      ), \"\")\n      : \"\";\n\n  const mapPath = `${path}.map`;\n\n  const plugins = [];\n  if (autoPrefix) {\n    plugins.push(autoprefixer());\n  }\n  plugins.push(cssnano({\n    preset:       \"default\",\n    reduceIdents: false,\n    zindex:       false,\n  }));\n\n  const options = sourceMap\n    ? {\n      from: undefined,\n      to:  path,\n      map: { inline: false }\n    }\n    : { from: undefined };\n\n  postcss(plugins)\n    .process(cssString, options)\n    .then(result => {\n      result.warnings().forEach(warn => {\n        console.warn(COLOR_RED, \"Warning\", COLOR_WHITE, warn.toString()); // eslint-disable-line no-console\n      });\n      saveToFile(path, beautify ? beautifyCSS(result.css) : result.css);\n      if (gzip) {\n        tar.c(\n          { gzip: true },\n          [path]\n        ).pipe(fs.createWriteStream(`${path}.gz`));\n      }\n      if (sourceMap) {\n        saveToFile(mapPath, result.map);\n      }\n    });\n};\n\n"],"names":["autoprefixer","require","cssbeautify","fs","J2c","postcss","cssnano","tar","j2c","COLOR_RED","COLOR_WHITE","makeStyleSheet","styles","reduce","acc","styleList","Object","keys","length","forEach","style","scoped","sheet","beautifyCSS","cssString","indent","saveToFile","path","writeFileSync","writeCSS","css","autoPrefix","beautify","sourceMap","gzip","current","undefined","console","log","mapPath","plugins","push","preset","reduceIdents","zindex","options","from","to","map","inline","process","then","result","warnings","warn","toString","c","pipe","createWriteStream"],"mappings":"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"}