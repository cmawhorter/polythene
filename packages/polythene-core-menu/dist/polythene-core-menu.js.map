{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/list-tile.js","../../polythene-css-classes/menu.js","../src/menu.js"],"sourcesContent":["\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:           \"pe-list-tile__content\",\n  highSubtitle:      \"pe-list-tile__high-subtitle\",\n  primary:           \"pe-list-tile__primary\",\n  secondary:         \"pe-list-tile__secondary\",\n  subtitle:          \"pe-list-tile__subtitle\",\n  title:             \"pe-list-tile__title\",\n  contentFront:      \"pe-list-tile__content-front\",\n  \n  // states  \n  compact:           \"pe-list-tile--compact\",\n  compactFront:      \"pe-list-tile--compact-front\",\n  disabled:          \"pe-list-tile--disabled\",\n  hasFront:          \"pe-list-tile--front\",\n  hasHighSubtitle:   \"pe-list-tile--high-subtitle\",\n  hasSubtitle:       \"pe-list-tile--subtitle\",\n  header:            \"pe-list-tile--header\",\n  hoverable:         \"pe-list-tile--hoverable\",\n  insetH:            \"pe-list-tile--inset-h\",\n  insetV:            \"pe-list-tile--inset-v\",\n  selectable:        \"pe-list-tile--selectable\",\n  selected:          \"pe-list-tile--selected\",\n  rounded:           \"pe-list-tile--rounded\",\n  highlight:         \"pe-list-tile--highlight\",\n  sticky:            \"pe-list-tile--sticky\",\n  navigation:        \"pe-list-tile--navigation\",\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, isServer, pointerEndMoveEvent, deprecation, stylePropCompare } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst DEFAULT_OFFSET_H           = 0;\nconst DEFAULT_OFFSET_V           = \"79%\";\nconst DEFAULT_TYPE               = \"floating\";\nconst MIN_WIDTH                   = 1.5;\nconst DEFAULT_SHADOW_DEPTH                   = 1;\n\nconst isTopMenu = ({ state, attrs }) =>\n  attrs.topMenu || stylePropCompare({\n    element: state.dom(),\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"top_menu\"}\"`\n  });\n\nconst positionMenu = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.target) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.target);\n  if (!targetEl) {\n    return;\n  }\n  const panelEl = state.panelEl;\n  if (!panelEl) {\n    return;\n  }\n\n  // Don't set the position or top offset if the menu position is fixed\n  const hasStylePositionFixed = stylePropCompare({\n    element: panelEl,\n    prop: \"position\",\n    equals: \"fixed\"\n  });\n\n  if (hasStylePositionFixed && !isTopMenu({ state, attrs })) {\n    Object.assign(panelEl.style, {});\n    panelEl.offsetHeight; // force reflow\n    return;\n  }\n\n  const contentEl = state.contentEl;\n  const parentRect = panelEl.parentNode.getBoundingClientRect();\n  const targetRect = targetEl.getBoundingClientRect();\n  const attrsOffsetH = attrs.offsetH !== undefined\n    ? attrs.offsetH\n    : attrs.offset !== undefined\n      ? attrs.offset // deprecated\n      : DEFAULT_OFFSET_H;\n  const attrsOffsetV = attrs.offsetV !== undefined\n    ? attrs.offsetV\n    : DEFAULT_OFFSET_V;\n  const offsetH = attrsOffsetH.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetH) * 0.01 * targetRect.width)\n    : Math.round(parseFloat(attrsOffsetH));\n  const offsetV = attrsOffsetV.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetV) * 0.01 * targetRect.height)\n    : Math.round(parseFloat(attrsOffsetV));\n  let positionOffsetV = offsetV;\n\n  const attrsOrigin = attrs.origin || \"top\";\n  const origin = attrsOrigin.split(/\\W+/).reduce((acc, curr) => (\n    acc[curr] = true,\n    acc\n  ), {});\n\n  const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n\n  if (attrs.reposition) {\n    // get the first List Tile to calculate the top position  \n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffsetV = firstItemRect.top - selectedItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = targetRect.height - alignRect.height;\n    positionOffsetV += Math.abs(heightDiff) / 2;\n  } else if (attrs.origin && !hasStylePositionFixed) {\n    if (origin.top) {\n      positionOffsetV += targetRect.top - parentRect.top;\n    } else if (origin.bottom) {\n      positionOffsetV += targetRect.top - parentRect.bottom;\n    }\n  }\n\n  if (attrs.height) {\n    const firstItemHeight = firstItem\n      ? firstItem.clientHeight\n      : 48; // default List Tile height\n    if (attrs.height === \"max\") {\n      const topMargin = positionOffsetV;\n      const bottomMargin = firstItemHeight;\n      panelEl.style.height = `calc(100% - ${topMargin + bottomMargin}px)`;\n    } else {\n      const height = /^\\d+$/.test(attrs.height.toString())\n        ? `${attrs.height}px`\n        : attrs.height;\n      panelEl.style.height = height;\n    }\n  }\n\n  // prevent animated changes\n  const transitionDuration = panelEl.style.transitionDuration;\n  panelEl.style.transitionDuration = \"0ms\";\n\n  if (panelEl.parentNode && !hasStylePositionFixed) {\n    if (origin.right) {\n      panelEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n    } else {\n      panelEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n    }\n    if (origin.bottom) {\n      panelEl.style.bottom = positionOffsetV + \"px\";\n    } else {\n      panelEl.style.top = positionOffsetV + \"px\";\n    }\n    panelEl.style.transformOrigin = attrsOrigin.split(/\\W+/).join(\" \");\n  }\n\n  panelEl.offsetHeight; // force reflow\n  panelEl.style.transitionDuration = transitionDuration;\n};\n\nconst scrollContent = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.scrollTarget) {\n    return;\n  }\n  const scrollTargetEl = document.querySelector(attrs.scrollTarget);\n  if (!scrollTargetEl) {\n    return;\n  }\n  state.contentEl.scrollTop = scrollTargetEl.offsetTop;\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => state.update()\n    : null,\n  domElements: {\n    el: state.panelEl,\n    showClassElement: state.dom(),\n  },\n  showClass: classes.visible,\n});\n\nconst showMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst unifyWidth = width =>\n  width < MIN_WIDTH ? MIN_WIDTH : width;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nconst handleSubscriptions = (vnode, which) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (which === \"mount\") {\n    subscribe(\"resize\", state.update);\n    subscribe(\"keydown\", state.handleEscape);\n    setTimeout(() => {\n      state.activateDismissTap();\n      showMenu(state, attrs);\n    }, 0);\n  } else {\n    unsubscribe(\"resize\", state.update);\n    unsubscribe(\"keydown\", state.handleEscape);\n    state.deActivateDismissTap();\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const dom = createStream(null);\n  const attrs = vnode.attrs;\n  if (attrs.offset !== undefined) {\n    deprecation(\"Menu\", { option: \"offset\", newOption: \"offsetH\" });\n  }\n  if (attrs.size !== undefined) {\n    deprecation(\"Menu\", { option: \"size\", newOption: \"width\" });\n  }\n  const visible = createStream(false);\n  const transitioning = createStream(false);\n  return {\n    dom,\n    visible,\n    transitioning,\n    activateDismissTap: undefined, // set in onMount\n    contentEl: undefined, // set in onMount\n    deActivateDismissTap: undefined, // set in onMount\n    handleDismissTap: undefined, // set in onMount\n    handleEscape: undefined, // set in onMount\n    panelEl: undefined, // set in onMount\n    update: undefined, // set in onMount\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n  state.panelEl = vnode.dom.querySelector(`.${classes.panel}`);\n  Object.assign(state.panelEl.style, attrs.style);\n  state.contentEl = vnode.dom.querySelector(`.${classes.content}`);\n\n  if (!attrs.permanent) {\n    state.handleDismissTap = e => {\n      if (e.target === state.panelEl) {\n        return;\n      }\n      hideMenu(state, attrs);\n    };\n\n    state.update = () => {\n      positionMenu(state, attrs);\n      scrollContent(state, attrs);\n    };\n\n    state.activateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.addEventListener(evt, state.handleDismissTap));\n    };\n\n    state.deActivateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.removeEventListener(evt, state.handleDismissTap));\n    };\n\n    state.handleEscape = e => {\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        hideMenu(state, Object.assign(\n          {},\n          attrs,\n          { hideDelay: 0 }\n        ));\n      }\n    };\n\n    handleSubscriptions(vnode, \"mount\");\n  }\n};\n\nexport const onUnMount = vnode => {\n  const attrs = vnode.attrs;\n  if (!attrs.permanent) {\n    handleSubscriptions(vnode, \"unmount\");\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  const type = attrs.type || DEFAULT_TYPE;\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs, { remove: [\"style\"] }),\n    {\n      className: [\n        classes.component,\n        attrs.permanent ? classes.permanent : null,\n        attrs.origin ? classes.origin : null,\n        attrs.backdrop ? classes.showBackdrop : null,\n        attrs.topMenu ? classes.isTopMenu : null,\n        type === \"floating\" && !attrs.permanent ? classes.floating : null,\n        attrs.width || attrs.size ? widthClass(unifyWidth(attrs.width || attrs.size)) : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, Shadow }) => {\n  const attrs = vnode.attrs;\n  const shadowDepth = attrs.shadowDepth !== undefined\n    ? attrs.shadowDepth\n    : attrs.z !== undefined \n      ? attrs.z // deprecated\n      : DEFAULT_SHADOW_DEPTH; \n  return [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop,\n      }\n    ),\n    h(\"div\",\n      {\n        className: classes.panel,\n        key: \"panel\",\n      },\n      [\n        h(Shadow, {\n          shadowDepth,\n          animated: true,\n          key: \"shadow\",\n        }),\n        h(\"div\", \n          {\n            className: classes.content,\n            key: \"content\",\n          },\n          attrs.content\n            ? attrs.content\n            : vnode.children\n        )\n      ]\n    )\n  ];\n};"],"names":["component","content","highSubtitle","primary","secondary","subtitle","title","contentFront","compact","compactFront","disabled","hasFront","hasHighSubtitle","hasSubtitle","header","hoverable","insetH","insetV","selectable","selected","rounded","highlight","sticky","navigation","panel","placeholder","backdrop","floating","origin","permanent","showBackdrop","visible","width_auto","width_n","isTopMenu","listTile","listTileClasses","selectedListTile","getElement","vnode","attrs","element","DEFAULT_OFFSET_H","DEFAULT_OFFSET_V","DEFAULT_TYPE","MIN_WIDTH","DEFAULT_SHADOW_DEPTH","state","topMenu","stylePropCompare","dom","pseudoSelector","prop","contains","positionMenu","isServer","target","targetEl","document","querySelector","panelEl","hasStylePositionFixed","equals","style","offsetHeight","contentEl","parentRect","parentNode","getBoundingClientRect","targetRect","attrsOffsetH","offsetH","undefined","offset","attrsOffsetV","offsetV","toString","indexOf","Math","round","parseFloat","width","height","positionOffsetV","attrsOrigin","split","reduce","acc","curr","firstItem","querySelectorAll","classes","reposition","selectedItem","firstItemRect","selectedItemRect","top","alignEl","alignRect","heightDiff","abs","bottom","firstItemHeight","clientHeight","topMargin","bottomMargin","test","transitionDuration","right","left","transformOrigin","join","scrollContent","scrollTarget","scrollTargetEl","scrollTop","offsetTop","transitionOptions","isShow","beforeTransition","update","domElements","el","showClassElement","showClass","showMenu","transitionComponent","hideMenu","unifyWidth","widthClass","size","replace","handleSubscriptions","which","subscribe","handleEscape","setTimeout","activateDismissTap","unsubscribe","deActivateDismissTap","getInitialState","createStream","deprecation","option","newOption","transitioning","handleDismissTap","redrawOnUpdate","merge","onMount","e","pointerEndMoveEvent","forEach","evt","addEventListener","removeEventListener","key","hideDelay","onUnMount","createProps","k","keys","type","filterSupportedAttributes","remove","className","tone","class","createContent","h","renderer","Shadow","shadowDepth","z","animated","children"],"mappings":"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"}